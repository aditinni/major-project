<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Guide</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Playwrite+GB+S:ital,wght@0,100..400;1,100..400&family=Quicksand:wght@300..700&family=Teko:wght@300..700&display=swap');
      /* Base styling */
      body {
        font-family: Arial, sans-serif;
        background-color: #111111;
        color: #ffffff;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Flexbox container styling */
      .flex {
        display: flex;
        min-height: 100vh;
      }

      .right {
        flex-grow: 1;
        padding: 20px;
      }

      /* Navbar and header */
      nav {
        display: flex;
        justify-content:end;
        align-items: center;
        padding: 10px;
        background-color: #0f0f0f;
    
        margin-bottom: 20px;
        border-bottom: 2px solid #555;
      }

      nav button,
      nav input[type="button"] {
        background-color: #555;
        color: #fff;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px;
      }

      nav a.logout {
        color: white;
        text-decoration: none;
      }

      /* Accordion styling */
      .accordion {
        background-color:#191919;

        color: white;
        cursor: pointer;
        padding: 15px;
        width: 100%;
        border: 1px solid  #555;
        text-align: left;
        outline: none;
        font-size: 18px;
        margin-top: 15px;
        border-radius: 8px;
        transition: background-color 0.3s, color 0.3s;
      }

      .accordion.active,
      .accordion:hover {
        background-color: #2c2323;
        transform: none;
      }
      
      

      .panel {
        background-color: #333;
        padding: 20px;
        display: none;
        border-radius: 8px;
        margin-bottom: 20px;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Table styling */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #444;
      }

      th {
        background-color: #222;
        color: #aaa;
      }

      /* Styled Icons */
      .icon-btn {
        font-size: 24px;
        border: none;
        background: none;
        color: #aaa;
        cursor: pointer;
        transition: color 0.3s;
      }

      .icon-btn:hover {
        color: #ff9800;
        background-color: transparent;
      }

      /* Custom Checkbox styling */
      .custom-checkbox {
        appearance: none;
        background-color: #333;
        border: 2px solid #555;
        padding: 10px;
        width: 24px;
        height: 24px;
        border-radius: 4px;
        display: inline-block;
        position: relative;
        cursor: pointer;
      }

      .custom-checkbox:checked {
        background-color: #4caf50;
        border: none;
      }

      .custom-checkbox:checked::before {
        content: "✓";
        position: absolute;
        top: 0;
        left: 5px;
        color: white;
        font-weight: bold;
      }

      /* YouTube icon styling for multiple videos */
      .youtube-icons {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      /* Full-width video overlay */
      #video-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      #video-frame {
        width: 80%;
        height: 60%;
        border-radius: 10px;
      }

      #close-video {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #444;
        color: #fff;
        font-size: 24px;
        border: none;
        cursor: pointer;
      }
      #icon:hover {
        cursor: pointer;
      }
      /* Light mode styles */
      .lightmode {
        background-color: #ffffff;
        color: #000000;
      }

      .lightmode nav {
        background-color: #f0f0f0;
      }

      .lightmode .accordion {
        background-color: #f9f9f9;
        color: #000000;
      }

      .lightmode .accordion.active,
      .lightmode .accordion:hover {
        background-color: #e0e0e0;
      }

      .lightmode .panel {
        background-color: #f2f2f2;
        color: #000000;
      }
      .summarizer a {
        text-decoration: none;
        color: white;
      }
       

    /* Sidebar styling */
    .sidebar {
      width: 250px;
      background-color: #111111;
      color: #fff;
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
      border-right: 2px solid #555;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar h2 {
      font-size: 1.5rem;
      color: #ff9800;
      margin-bottom: 20px;
    }

    .sidebar a {
      color: #ddd;
      text-decoration: none;
      font-size: 1.1rem;
      padding: 10px;
      background-color: #333;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: background-color 0.3s;
    }

    .sidebar a:hover {
      background-color:#7c2d12;
      color: #ff9800;
    }

    .sidebar a i {
      font-size: 1.3rem;
    }

    /* Adjust the main content to allow space for the sidebar */
    .right {
      margin-left: 270px;
      padding: 20px;
    }

    /* Responsive Styling */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .right {
        margin-left: 0;
        padding: 20px;
      }
    }

    .sidebar h2{
      font-family: "Teko", sans-serif;
      font-size: 2.5em;
      text-shadow: 2px 2px 20px orange;
    }

/* Profile icon and dropdown styling */
.profile-container {
  position: relative;
  display: inline-block;
  margin-left: 15px;
}

.flex-items{
  display: flex;
  justify-content:center;
  align-items: center;
  gap: 30px;

}

/* Modal Background */
.note-modal {
  display: none; /* Hidden by default */
  position: fixed;
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
  justify-content: center;
  align-items: center;
  transition: opacity 0.3s ease;
}

/* Modal Content */
.note-modal .modal-content {
  background-color: #333;
  margin: 15% auto;
  padding: 30px;
  border-radius: 10px;
  width: 50%; /* Adjust width */
  max-width: 500px;
  color: #fff;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease-out;
}

/* Close Button */
.note-modal .close-modal {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  position: absolute;
  top: 10px;
  right: 20px;
  cursor: pointer;
  transition: color 0.3s ease;
}

.note-modal .close-modal:hover,
.note-modal .close-modal:focus {
  color: #ff9800;
}

/* Textarea Styling */
#note-textarea:focus {
  outline: none;
  border-color: #4caf50;
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
}

/* Button Styling */
button:hover {
  background-color: #45a049;
  transform: scale(1.05);
}



    </style>
  </head>
  <body>

<!-- Modal for Adding Notes -->
<div id="note-modal" class="note-modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeNoteModal()">&times;</span>
    <h2 id="modal-topic-title" style="font-family: 'Teko', sans-serif; font-size: 1.8rem; color: #ff9800; text-align: center;" ></h2>
    <form action="/notes" method="post">

      <input type="text" name="topic" placeholder="Enter Topic" style="
      width: 93%;
      padding: 15px;
      font-size: 1rem;
      font-family: 'Quicksand', sans-serif;
      border-radius: 10px;
      border: 2px solid #555;
      background-color: #222;
      color: white;
      transition: all 0.3s ease-in-out;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      resize: none;
      margin: 10px 0px;
    " required>
    
      <textarea id="note-textarea" placeholder="Add your note here..." rows="8" style="
        width: 93%;
        padding: 15px;
        font-size: 1rem;
        font-family: 'Quicksand', sans-serif;
        border-radius: 10px;
        border: 2px solid #555;
        background-color: #222;
        color: white;
        resize: none;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      " name="notes" required></textarea>
      <button type="submit" style="
        margin-top: 20px;
        padding: 12px 25px;
        background-color: #d26e09;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      ">Save Note</button>
    </form>
  
  </div>
</div>

  
 <!-- Sidebar Section -->
 <div class="sidebar" id="sidebar">
  <h2 style="text-align: center;">DIGITAL GUIDE</h2>
  <a href="#" onclick="openChatbot()">
    <i class="fa fa-comments"></i> Chatbot
  </a>
  <a href="/summarize">
    <i class="fa fa-file-text"></i> Text Summarizer
  </a>
  <a href="/video-summarizer">
    <i class="fa fa-video-camera"></i> Video Summarizer
  </a>
</div>

    <div class="flex">
      <div class="right">
        <nav>
          <div class="flex-items">
           <a href="/logout" class="logout"><i class="fa fa-sign-out" style="color: rgb(156, 149, 149); font-size: 24px;"></i></a>
            <span onclick="toggleDarkMode()" id="icon">☀️</span>
            
            <!-- Profile Icon with Dropdown -->
            <div class="profile-container">
             <a href="/profile" style="color: rgb(156, 149, 149);; font-size:24px ;"> <i class="fa fa-user-circle profile-icon"></i></a>
            </div>
          </div>
        </nav>

        <h1>Welcome <%= user.name %></h1>
        <p>
          Our Digital Guide provides you with <%=user.domainOfInterest %>
          tutorials, perfect for learning and skill development.
        </p>

        <!-- Progress Bar -->
        <div
          class="justify-center items-start"
          style="margin-top: 3rem; height: auto"
        >
          <div
            style="
              background-color: #0f0f0f;
              padding: 1rem;
              border-radius: 8px;
              width: 100%;
              max-width: 400px;
              border: 2px solid #555;
              color: #fff;
            "
          >
            <div
              style="
                font-size: 1.2rem;
                font-weight: bold;
                margin-bottom: 0.5rem;
              "
            >
              Your Progress:
            </div>
            <p
              id="completed-count"
              style="font-size: 1rem; margin-bottom: 0.5rem"
            >
              <%= completedTopics %> out of <%= totalTopics %> topics completed
            </p>
            <div
              style="
                background-color: #212121;
                border-radius: 5px;
                overflow: hidden;
                height: 24px;
                width: 100%;
              "
            >
              <div
                id="progress-bar"
                style="
                  width: <%= (completedTopics / totalTopics) * 100 %>%;
                  background-color: #4caf50;
                  height: 100%;
                  text-align: center;
                  line-height: 24px;
                  color: white;
                  font-size: 0.9rem;
                  font-weight: bold;
                "
              >
                <%= Math.round((completedTopics / totalTopics) * 100) %>%
                complete
              </div>
            </div>
          </div>
        </div>

        <!-- Accordion section for each day's content -->
        <% arrayToRender.forEach((dayContent, index) => { %>
        <button class="accordion">
          Day <%= dayContent.day %>: <%= dayContent.topic %>
        </button>
        <div class="panel">
          <table>
            <thead>
              <tr>
                <th>Status</th>
                <th>Topic</th>
                <th>Article</th>
                <th>YouTube</th>
                <th>Practice</th>
                <th>Note</th>
                <th>Difficulty</th>
                <th>Revision</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <input type="checkbox" class="custom-checkbox"
                  onchange="updateProgress(this)" data-id="<%=
                  user.domainOfInterest.replace(/\s+/g, '') + '-' + index %>"
                  <%=
                  user.topicsCompleted.includes(user.domainOfInterest.replace(/\s+/g,
                  '') + '-' + index) ? 'checked' : '' %> />
                </td>
                <td><%= dayContent.topic %></td>
                <td>
                  <a href="<%= dayContent.article %>" target="_blank"
                    ><i class="fa fa-clipboard icon-btn"></i
                  ></a>
                </td>
                <td class="youtube-icons">
                  <% dayContent.videolink.forEach(link => { %>
                  <span onclick="openVideo('<%= link %>')"
                    ><i
                      class="fa fa-youtube-play icon-btn"
                      style="color: red; font-size: 36px"
                    ></i
                  ></span>
                  <% }) %>
                </td>
                <td>
                  <% if (dayContent.practice) { %>
                  <a href="<%= dayContent.practice %>" target="_blank"
                    ><i class="fa fa-link icon-btn"></i
                  ></a>
                  <% } else { %>
                  <i class="fa fa-ban icon-btn" title="Not available"></i>
                  <% } %>
                </td>
                <td>
                  <button class="icon-btn"><i class="fa fa-pencil" onclick="openNoteModal('<%=dayContent.topic%>')"></i></button>
                </td>
                <td><span class="difficulty medium">Medium</span></td>
                <td>
                  <button class="icon-btn">
                    <i class="fa fa-star"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <% }) %>
      </div>
    </div>

    <!-- Full-width video overlay -->
    <div id="video-overlay">
      <button id="close-video" onclick="closeVideo()">✖</button>
      <iframe
        id="video-frame"
        src=""
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>

    <script>
      // Toggle dark mode
      function toggleDarkMode() {
        document.body.classList.toggle("lightmode");
        const icon = document.getElementById("icon");
        icon.textContent = document.body.classList.contains("lightmode")
          ? "🌙"
          : "☀️";

        // Toggle accordion and panel styles for light mode
        const accordions = document.getElementsByClassName("accordion");
        const panels = document.getElementsByClassName("panel");

        for (let accordion of accordions) {
          accordion.classList.toggle("lightmode");
        }
        for (let panel of panels) {
          panel.classList.toggle("lightmode");
        }
      }
      //sidebar

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const toggleButton = document.querySelector(".sidebar-toggle");
        
        sidebar.classList.toggle("active");
        toggleButton.classList.toggle("active");
      }

      // Open chatbot in new window
      function openChatbot() {
        window.open("http://localhost:5000"); // Open the chatbot UI
      }

      // Accordion toggle function
      const acc = document.getElementsByClassName("accordion");
      for (let i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
          this.classList.toggle("active");
          const panel = this.nextElementSibling;
          panel.style.display =
            panel.style.display === "block" ? "none" : "block";
        });
      }

      // Open video overlay
      function openVideo(videoLink) {
        document.getElementById("video-overlay").style.display = "flex";
        document.getElementById("video-frame").src = videoLink;
      }

      // Close video overlay
      function closeVideo() {
        document.getElementById("video-overlay").style.display = "none";
        document.getElementById("video-frame").src = "";
      }

      // Update on MongoDB when checkbox is toggled
      document.querySelectorAll(".custom-checkbox").forEach((checkbox) => {
        checkbox.addEventListener("change", async (event) => {
          const topicId = event.target.getAttribute("data-id");
          const isChecked = event.target.checked;

          try {
            const response = await fetch("/update-topic-status", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ topicId, isChecked }),
            });
            const result = await response.json();
            console.log(result.message);
          } catch (error) {
            console.error("Error updating topic:", error);
          }
        });
      });

      // update Progress Bar when checkBox change
      function updateProgress(checkbox) {
        const checkboxes = document.querySelectorAll(".custom-checkbox");

        const completedTopics = Array.from(checkboxes).filter(
          (cb) => cb.checked
        ).length;

        const totalTopics = checkboxes.length;

        const progressPercentage = (completedTopics / totalTopics) * 100;

        const progressBar = document.getElementById("progress-bar");
        progressBar.style.width = progressPercentage + "%";
        progressBar.textContent = Math.round(progressPercentage) + "%";

        document.getElementById(
          "completed-count"
        ).textContent = `${completedTopics} out of ${totalTopics} topics completed`;
      }






// Open the note modal
function openNoteModal(topic) {
  document.getElementById('note-modal').style.display = 'flex';
  document.getElementById('modal-topic-title').textContent = 'Note for ' + topic;
  document.getElementById('note-textarea').value = ''; // Clear the textarea each time
}

// Close the note modal
function closeNoteModal() {
  document.getElementById('note-modal').style.display = 'none';
}

// Save the note (this is a simple function, adjust it to save the note data)
function saveNote() {
  const noteText = document.getElementById('note-textarea').value;
  const topic = document.getElementById('modal-topic-title').textContent.replace('Note for ', '');
  // You can send the note to the server here using fetch or update a database

  // For now, just log it
  console.log('Note saved for ' + topic + ': ' + noteText);

  // Close the modal after saving
  closeNoteModal();
}



      
    </script>
  </body>
</html>
